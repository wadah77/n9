<!DOCTYPE html>
<!-- saved from url=(0045)file:///C:/Users/Wadah/Desktop/html3/d18.html -->
<html lang="ar"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رسم بيانات X و Y مع مقارنة بين ملفين</title>
    
    <!-- تحميل المكتبات من CDNs -->
    <script src="./index_files/chart.js.download"></script>
    <script src="./index_files/tfjs"></script>
    <script src="./index_files/xlsx.full.min.js.download"></script>
    
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        canvas { max-width: 600px; margin-top: 20px; }
        table { margin-top: 20px; border-collapse: collapse; width: 80%; margin-left: auto; margin-right: auto; }
        th, td { padding: 8px; text-align: center; border: 1px solid #ddd; }
    </style>
</head>
<body>

    <h2>إدخال القيم لرسم البيانات</h2>
    <label for="xInput">X:</label>
    <input type="text" id="xInput" placeholder="أدخل القيم مفصولة بفاصلة">
    <label for="yInput">Y:</label>
    <input type="text" id="yInput" placeholder="أدخل القيم مفصولة بفاصلة">
    <button onclick="drawChart()">رسم</button>

    <br><br>

    <input type="file" id="fileInput">
    <button onclick="handleFileUpload()">تحميل الملف الأول</button>

    <br><br>

    <input type="file" id="fileInput2">
    <button onclick="handleFileUpload2()">تحميل الملف الثاني</button>

    <div id="file1Data"></div> 
    <div id="file2Data"></div> 

    <div id="chartContainer">
        <canvas id="myChart"></canvas>
    </div>
    
    <script>
        let xValues = [], yValues = [];
        let xValues2 = [], yValues2 = [];
        let chartInstance = null;

        function handleFileUpload() {
            const file = document.getElementById("fileInput").files[0];
            if (!file) {
                alert("يرجى اختيار ملف Excel أولاً!");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                xValues = jsonData.map(row => parseFloat(row[0])).filter(n => !isNaN(n));
                yValues = jsonData.map(row => parseFloat(row[1])).filter(n => !isNaN(n));

                if (xValues.length !== yValues.length) {
                    alert("خطأ في تحميل البيانات! تأكد من صحة القيم في الملف.");
                    return;
                }

                displayData(jsonData, 'file1Data');
                drawChart();
            };
            reader.readAsArrayBuffer(file);
        }

        function handleFileUpload2() {
            const file = document.getElementById("fileInput2").files[0];
            if (!file) {
                alert("يرجى اختيار ملف Excel ثانٍ!");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                xValues2 = jsonData.map(row => parseFloat(row[0])).filter(n => !isNaN(n));
                yValues2 = jsonData.map(row => parseFloat(row[1])).filter(n => !isNaN(n));

                if (xValues2.length !== yValues2.length) {
                    alert("خطأ في تحميل البيانات! تأكد من صحة القيم في الملف الثاني.");
                    return;
                }

                displayData(jsonData, 'file2Data');
                drawComparisonChart();
            };
            reader.readAsArrayBuffer(file);
        }

        function displayData(jsonData, elementId) {
            const container = document.getElementById(elementId);
            container.innerHTML = `<h3>البيانات:</h3>`;
            let table = `<table><tr><th>X</th><th>Y</th></tr>`;
            jsonData.forEach(row => {
                if (row.length >= 2) {
                    table += `<tr><td>${row[0]}</td><td>${row[1]}</td></tr>`;
                }
            });
            table += `</table>`;
            container.innerHTML += table;
        }

        function drawChart() {
            if (!xValues.length || !yValues.length) {
                alert("يرجى إدخال البيانات أولاً!");
                return;
            }

            const ctx = document.getElementById("myChart").getContext("2d");
            if (chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'البيانات المدخلة',
                        data: xValues.map((x, i) => ({ x: x, y: yValues[i] })),
                        backgroundColor: 'blue',
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: 'X' } },
                        y: { title: { display: true, text: 'Y' } }
                    }
                }
            });
        }

        function drawComparisonChart() {
            if (!xValues2.length || !yValues2.length) {
                alert("الرجاء تحميل الملف الثاني أولاً!");
                return;
            }

            const ctx = document.getElementById("myChart").getContext("2d");
            if (chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'الملف الأول',
                            data: xValues.map((x, i) => ({ x: x, y: yValues[i] })),
                            backgroundColor: 'blue',
                            pointRadius: 5
                        },
                        {
                            label: 'الملف الثاني',
                            data: xValues2.map((x, i) => ({ x: x, y: yValues2[i] })),
                            backgroundColor: 'red',
                            pointRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: 'X' } },
                        y: { title: { display: true, text: 'Y' } }
                    }
                }
            });
        }
    </script>


</body></html>